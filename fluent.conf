<source>
  type tail
  format json
  time_key time
  path /var/log/containers/*.log
  pos_file /var/log/fluentd-containers.log.pos
  time_format %Y-%m-%dT%H:%M:%S.%NZ
  tag reform.*
  read_from_head true
</source>

<match reform.**>
  type record_reformer
  enable_ruby true
  tag kubernetes.${tag_suffix[4].split('-')[0..-2].join('-')}
</match>

<match kubernetes.fluentd-kube2es*>
  type null
</match>

<match kubernetes.**>
  @type copy

  <store>
    @type stdout
    @id stdout_output
  </store>

  <store>
    @type elasticsearch
    host 172.16.0.11
    port 9200
    logstash_format true
    logstash_prefix kubernetes
    include_tag_key true
    flush_interval 10s
  </store>

</match>
